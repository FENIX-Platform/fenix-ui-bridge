!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("jquery"),require("underscore"),require("q"),require("loglevel"),require("object-hash"),require("amplify-store"));else if("function"==typeof define&&define.amd)define(["jquery","underscore","q","loglevel","object-hash","amplify-store"],t);else{var r="object"==typeof exports?t(require("jquery"),require("underscore"),require("q"),require("loglevel"),require("object-hash"),require("amplify-store")):t(e.jquery,e.underscore,e.q,e.loglevel,e["object-hash"],e["amplify-store"]);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,function(e,t,r,n,i,o){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){var n,i;n=[r(2),r(3),r(4),r(5),r(6),r(7),r(8)],i=function(e,t,r,n,i,o,s){"use strict";function a(t){function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}var n=t||{};this.cache_db={},this.environment=n.environment||"production",this.ENVIR=this.environment.toUpperCase(),this.USE_CACHE=n.cache,this.SERVICE_PROVIDER=e["serviceProvider"+r(this.ENVIR.toLowerCase())],this.SERVICE_PROVIDER||alert(this.environment+" is not a valid FENIX environment: [develop, production]")}return a.prototype.find=function(r){var i=t.extend(!0,{type:"find",environment:this.ENVIR},r),o=this._getCacheItem(i),s=this;if(this.USE_CACHE&&o)return n.promise(function(e){return e(o)});var a=r.SERVICE_PROVIDER||this.SERVICE_PROVIDER,c=r.findService||e.findService,u=r.body;return n(t.ajax({url:a+c+this._parseQueryParams(r.params),type:r.type||"POST",contentType:r.dataType||"application/json",data:JSON.stringify(u),dataType:r.dataType||"json"})).then(function(e){return s._setCacheItem(i,e),n.promise(function(e,t,r){return e(s._getCacheItem(i))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getEnumeration=function(r){var i=t.extend(!0,{type:"enumeration",environment:this.ENVIR},r),o=this._getCacheItem(i),s=this;if(this.USE_CACHE&&o)return n.promise(function(e){return e(o)});var a=r.serviceProvider||this.SERVICE_PROVIDER,c=r.enumerationService||e.enumerationService;return n(t.ajax({url:a+c+r.uid,type:r.type||"GET",dataType:r.dataType||"json"})).then(function(e){return s._setCacheItem(i,e),n.promise(function(e,t,r){return e(s._getCacheItem(i))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getCodeList=function(r){var i=t.extend(!0,{type:"codelist",environment:this.ENVIR},r),o=this._getCacheItem(i),s=this;if(this.USE_CACHE&&o)return n.promise(function(e){return e(o)});var a=r.serviceProvider||this.SERVICE_PROVIDER,c=r.codeListService||e.codelistService,u=r.body;return n(t.ajax({url:a+c+this._parseQueryParams(r.params),type:r.type||"POST",dataType:r.dataType||"json",contentType:r.contentType||"application/json",data:JSON.stringify(u)})).then(function(e){return s._setCacheItem(i,e),n.promise(function(e,t,r){return e(s._getCacheItem(i))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getResource=function(r){var i=t.extend(!0,{type:"resource",environment:this.ENVIR},r),o=this._getCacheItem(i),s=this;if(this.USE_CACHE&&o)return n.promise(function(e){return e(o)});var a=r.serviceProvider||this.SERVICE_PROVIDER,c=r.processesService||e.resourcesService,u=a+c+this._parseUidAndVersion(r,!0)+this._parseQueryParams(r.params);return n(t.ajax({url:u,type:r.type||"GET",contentType:r.contentType||"application/json",data:JSON.stringify(r.body)})).then(function(e){return s._setCacheItem(i,e),n.promise(function(e,t,r){return e(s._getCacheItem(i))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getProcessedResource=function(r){var i=t.extend(!0,{type:"process",environment:this.ENVIR},r),o=this._getCacheItem(i),s=this;if(this.USE_CACHE&&o)return n.promise(function(e){return e(o)});var a=r.serviceProvider||this.SERVICE_PROVIDER,c=r.processesService||e.processesService,u=r.hasOwnProperty("uid"),p=a+c+(u?this._parseUidAndVersion(r,!1):"")+this._parseQueryParams(r.params);return n(t.ajax({url:p,type:r.type||"POST",dataType:r.dataType||"json",contentType:r.contentType||"application/json",data:JSON.stringify(r.body)})).then(function(e){return s._setCacheItem(i,e),n.promise(function(e,t,r){return e(s._getCacheItem(i))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getMetadata=function(r){var i=t.extend(!0,{type:"metadata",environment:this.ENVIR},r),o=this._getCacheItem(i),s=this;if(this.USE_CACHE&&o)return n.promise(function(e){return e(o)});var a=r.serviceProvider||this.SERVICE_PROVIDER,c=r.metadataService||e.metadataService;return n(t.ajax({url:a+c+this._parseUidAndVersion(r,!0)+this._parseQueryParams(r.params),type:r.type||"GET",dataType:r.dataType||"json"})).then(function(e){return s._setCacheItem(i,e),n.promise(function(e,t,r){return e(s._getCacheItem(i))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype["export"]=function(r,i){var o=i&&i.serviceProvider||this.SERVICE_PROVIDER,s=o+e.exportService;return n(t.ajax({url:s,type:"POST",contentType:"application/json",data:JSON.stringify(r)})).then(function(e){var t={data:e,url:s};return n.promise(function(e,r,n){return e(t)})},function(e){return n.promise(function(t,r,n){return t(e)})})},a.prototype.getMDSD=function(r){var i=r||{},o=t.extend(!0,{type:"mdsd",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.serviceProvider||this.SERVICE_PROVIDER,u=i.mdsdService||e.mdsdService,p=c+u+this._parseQueryParams(i.params);return n(t.ajax({url:p,type:i.type||"GET",dataType:i.dataType||"json"})).then(function(e){return a._setCacheItem(o,e),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.all=function(e){return n.all(e)},a.prototype.getCacheKey=function(e){return this._getCacheKey(e)},a.prototype._parseQueryParams=function(e){if(!e)return"";var t="?";return r.each(e,function(e,r){t+=r+"="+e+"&"}),t.substring(0,t.length-1)},a.prototype._parseUidAndVersion=function(e,t){var r="",n=!1;return e.uid||i.warn("Impossible to find uid"),r=r.concat(e.uid),e.version&&(r=r.concat("/").concat(e.version),n=!0),t===!0&&n!==!0?"uid/"+r:r},a.prototype._setCacheItem=function(e,t){var r=this.getCacheKey(e);try{s.sessionStorage(r,t)}catch(n){this.cache_db[r]=t}return this._getCacheItem(r)},a.prototype._getCacheItem=function(e){var t=this.getCacheKey(e),r=s.sessionStorage(t);return r?r:this.cache_db[t]},a.prototype._getCacheKey=function(e){var t=o(e);return t},a}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n;n=function(){"use strict";var e="//fenix.fao.org/",t="//fenixservices.fao.org/";return{serviceProviderProduction:t+"d3s/",serviceProviderDevelop:e+"d3s_dev/",exportService:"/fenix/export",findService:"msd/resources/find",codelistService:"msd/codes/filter",enumerationService:"msd/choices/",processesService:"processes/",metadataService:"msd/resources/metadata/",resourcesService:"msd/resources/",mdsdService:"mdsd/",cache:!0}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=o}])});
define(["jquery","underscore","q","loglevel","object-hash","amplify-store"],function(e,t,r,n,i,o){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){var n,i;n=[r(2),r(3),r(4),r(5),r(6),r(7),r(8)],i=function(e,t,r,n,i,o,s){"use strict";function a(t){function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}var n=t||{};this.cache_db={},this.environment=n.environment||"production",this.ENVIR=this.environment.toUpperCase(),this.USE_CACHE=n.cache,this.SERVICE_PROVIDER=e["serviceProvider"+r(this.ENVIR.toLowerCase())],this.SERVICE_PROVIDER||alert(this.environment+" is not a valid FENIX environment: [develop, production]")}return a.prototype.find=function(i){var o=r.extend({type:"find",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.SERVICE_PROVIDER||this.SERVICE_PROVIDER,u=i.findService||e.findService,p=i.body;return n(t.ajax({url:c+u+this._parseQueryParams(i.params),type:i.type||"POST",contentType:i.dataType||"application/json",data:JSON.stringify(p),dataType:i.dataType||"json"})).then(function(e){return a._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.deleteMetadata=function(r){var i=r.SERVICE_PROVIDER||this.SERVICE_PROVIDER,o=r.metadataService||e.metadataService;return console.log(i+o+this._parseUidAndVersion(r,!0)),n(t.ajax({url:i+o+this._parseUidAndVersion(r,!0),type:r.type||"DELETE",dataType:"text"})).then(function(e){return n.promise(function(t,r,n){return t(e)})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.deleteResource=function(r){var i=r.SERVICE_PROVIDER||this.SERVICE_PROVIDER,o=r.resourcesService||e.resourcesService;return n(t.ajax({url:i+o+this._parseUidAndVersion(r,!0),type:r.type||"DELETE",dataType:"text"})).then(function(e){return n.promise(function(t,r,n){return t(e)})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype._protoSaveUpdate=function(e,r,i){var o=i.SERVICE_PROVIDER||this.SERVICE_PROVIDER,s=e,a=i.body,r=i.type||r;return n(t.ajax({contentType:i.contentType||"application/json",url:o+s,type:r,data:JSON.stringify(a),dataType:i.dataType||"json"})).then(function(e){return n.promise(function(t,r,n){return t(e)})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.saveMetadata=function(t){var r=t.metadataService||e.metadataService;return this._protoSaveUpdate(r,"POST",t)},a.prototype.saveDSD=function(t){var r=t.dsdService||e.dsdService;return this._protoSaveUpdate(r,"POST",t)},a.prototype.saveData=function(t){var r=t.resourcesService||e.resourcesService;return this._protoSaveUpdate(r,"POST",t)},a.prototype.updateDSD=function(t){var r=t.dsdService||e.dsdService;return this._protoSaveUpdate(r,"PUT",t)},a.prototype.updateData=function(t){var r=t.resourcesService||e.resourcesService;return this._protoSaveUpdate(r,"PUT",t)},a.prototype.deleteData=function(t){var r=t.resourcesService||e.resourcesService;return t.body.data=[],this._protoSaveUpdate(r,"PUT",t)},a.prototype.updateMetadata=function(t){var r=t.metadataService||e.metadataService;return t.dsdRid&&(t.body.dsd={rid:t.dsdRid}),this._protoSaveUpdate(r,"PUT",t)},a.prototype.getColumnDistinctValues=function(i){var o=r.extend({type:"distinct",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.serviceProvider||this.SERVICE_PROVIDER,u=i.columnDistinctValues||e.columnDistinctValues,p=c+u+this._parseUidAndVersion(i,!1)+"/"+i.columnId;return n(t.ajax({url:p,type:i.type||"GET",dataType:i.dataType||"json"})).then(function(e){return a._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getEnumeration=function(i){var o=r.extend({type:"enumeration",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.serviceProvider||this.SERVICE_PROVIDER,u=i.enumerationService||e.enumerationService;return n(t.ajax({url:c+u+i.uid,type:i.type||"GET",dataType:i.dataType||"json"})).then(function(e){return a._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getCodeList=function(i){var o=r.extend({type:"codelist",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.serviceProvider||this.SERVICE_PROVIDER,u=i.codeListService||e.codelistService,p=i.body;return n(t.ajax({url:c+u+this._parseQueryParams(i.params),type:i.type||"POST",dataType:i.dataType||"json",contentType:i.contentType||"application/json",data:JSON.stringify(p)})).then(function(e){return a._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getResource=function(i){var o=r.extend({type:"resource",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.serviceProvider||this.SERVICE_PROVIDER,u=i.processesService||e.resourcesService,p=c+u+this._parseUidAndVersion(i,!0)+this._parseQueryParams(i.params);return n(t.ajax({url:p,type:i.type||"GET",contentType:i.contentType||"application/json",data:JSON.stringify(i.body)})).then(function(e){return a._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getProcessedResource=function(i){var o=r.extend({type:"process",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.serviceProvider||this.SERVICE_PROVIDER,u=i.processesService||e.processesService,p=i.hasOwnProperty("uid"),d=c+u+(p?this._parseUidAndVersion(i,!1):"")+this._parseQueryParams(i.params);return n(t.ajax({url:d,type:i.type||"POST",dataType:i.dataType||"json",contentType:i.contentType||"application/json",data:JSON.stringify(i.body)})).then(function(e){return a._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.getMetadata=function(i){var o=r.extend({type:"metadata",environment:this.ENVIR},i),s=this._getCacheItem(o),a=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=i.serviceProvider||this.SERVICE_PROVIDER,u=i.metadataService||e.metadataService;return n(t.ajax({url:c+u+this._parseUidAndVersion(i,!0)+this._parseQueryParams(i.params),type:i.type||"GET",dataType:i.dataType||"json"})).then(function(e){return a._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(a._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype["export"]=function(r,i){var o=i&&i.serviceProvider||this.SERVICE_PROVIDER,s=o+e.exportService;return n(t.ajax({url:s,type:"POST",contentType:"application/json",data:JSON.stringify(r)})).then(function(e){var t={data:e,url:s};return n.promise(function(e,r,n){return e(t)})},function(e){return n.promise(function(t,r,n){return t(e)})})},a.prototype.getMDSD=function(i){var o=i||{},s=r.extend({type:"mdsd",environment:this.ENVIR},o),a=this._getCacheItem(s),c=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=o.serviceProvider||this.SERVICE_PROVIDER,p=o.mdsdService||e.mdsdService,d=u+p+this._parseQueryParams(o.params);return n(t.ajax({url:d,type:o.type||"GET",dataType:o.dataType||"json"})).then(function(e){return c._setCacheItem(s,e?e:null),n.promise(function(e,t,r){return e(c._getCacheItem(s))})},function(e){return n.promise(function(t,r,n){return r(e)})})},a.prototype.all=function(e){return n.all(e)},a.prototype.getCacheKey=function(e){return this._getCacheKey(e)},a.prototype._parseQueryParams=function(e){if(!e)return"";var t="?";return r.each(e,function(e,r){t+=r+"="+e+"&"}),t.substring(0,t.length-1)},a.prototype._parseUidAndVersion=function(e,t){var r="",n=!1;return e.uid||i.warn("Impossible to find uid"),r=r.concat(e.uid),e.version&&(r=r.concat("/").concat(e.version),n=!0),t===!0&&n!==!0?"uid/"+r:r},a.prototype._setCacheItem=function(e,t){var r=this.getCacheKey(e);try{s.sessionStorage(r,t)}catch(n){this.cache_db[r]=t}return this._getCacheItem(r)},a.prototype._getCacheItem=function(e){var t=this.getCacheKey(e),r=s.sessionStorage(t);return r?r:this.cache_db[t]},a.prototype._getCacheKey=function(e){var t=o(e);return t},a}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n;n=function(){"use strict";var e="//fenix.fao.org/",t="//fenixservices.fao.org/";return{serviceProviderProduction:t+"d3s/",serviceProviderDevelop:e+"d3s_dev/",exportService:"/fenix/export",findService:"msd/resources/find",codelistService:"msd/codes/filter",enumerationService:"msd/choices/",processesService:"processes/",metadataService:"msd/resources/metadata/",dsdService:"msd/resources/dsd",resourcesService:"msd/resources/",mdsdService:"mdsd/",columnDistinctValues:"msd/codes/distinct/",cache:!0}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=o}])});
//# sourceMappingURL=fenix-ui-bridge.min.js.map
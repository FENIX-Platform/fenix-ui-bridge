define(["jquery","underscore","q","loglevel","object-hash","amplify-store"],function(e,t,r,n,i,o){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){var n,i;n=[r(2),r(3),r(4),r(5),r(6),r(7),r(8)],i=function(e,t,r,n,i,o,a){"use strict";function s(t){function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}var n=t||{};this.cache_db={},this.environment=n.environment||"production",this.ENVIR=this.environment.toUpperCase(),this.USE_CACHE=n.cache,this.SERVICE_PROVIDER=e["serviceProvider"+r(this.ENVIR.toLowerCase())],this.SERVICE_PROVIDER||alert(this.environment+" is not a valid FENIX environment: [develop, production, demo, wiews]")}return s.prototype.find=function(i){var o=r.extend({type:"find",environment:this.ENVIR},i),a=this._getCacheItem(o),s=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=i.SERVICE_PROVIDER||this.SERVICE_PROVIDER,c=i.findService||e.findService,p=i.body;return n(t.ajax({url:u+c+this._parseQueryParams(i.params),type:i.type||"POST",contentType:i.dataType||"application/json",data:JSON.stringify(p),dataType:i.dataType||"json"})).then(function(e){return s._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(s._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.deleteMetadata=function(r){var i=r.SERVICE_PROVIDER||this.SERVICE_PROVIDER,o=r.metadataService||e.metadataService;return n(t.ajax({url:i+o+this._parseUidAndVersion(r,!0),type:r.type||"DELETE",dataType:"text"})).then(function(e){return n.promise(function(t,r,n){return t(e)})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.deleteResource=function(r){var i=r.SERVICE_PROVIDER||this.SERVICE_PROVIDER,o=r.resourcesService||e.resourcesService;return n(t.ajax({url:i+o+this._parseUidAndVersion(r,!0),type:r.type||"DELETE",dataType:"text"})).then(function(e){return n.promise(function(t,r,n){return t(e)})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype._protoSaveUpdate=function(e,r,i){var o=i.SERVICE_PROVIDER||this.SERVICE_PROVIDER,a=e,s=i.body,r=i.type||r;return n(t.ajax({contentType:i.contentType||"application/json",url:o+a,type:r,data:JSON.stringify(s),dataType:i.dataType||"json"})).then(function(e){return n.promise(function(t,r,n){return t(e)})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.saveMetadata=function(t){var r=t.metadataService||e.metadataService;return this._protoSaveUpdate(r,"POST",t)},s.prototype.saveDSD=function(t){var r=t.dsdService||e.dsdService;return this._protoSaveUpdate(r,"POST",t)},s.prototype.saveData=function(t){var r=t.resourcesService||e.resourcesService;return this._protoSaveUpdate(r,"POST",t)},s.prototype.updateDSD=function(t){var r=t.dsdService||e.dsdService;return this._protoSaveUpdate(r,"PUT",t)},s.prototype.updateData=function(t){var r=t.resourcesService||e.resourcesService;return this._protoSaveUpdate(r,"PUT",t)},s.prototype.deleteData=function(t){var r=t.resourcesService||e.resourcesService;return t.body.data=[],this._protoSaveUpdate(r,"PUT",t)},s.prototype.updateMetadata=function(t){var r=t.metadataService||e.metadataService;return t.dsdRid&&(t.body.dsd={rid:t.dsdRid}),this._protoSaveUpdate(r,"PUT",t)},s.prototype.getColumnDistinctValues=function(i){var o=r.extend({type:"distinct",environment:this.ENVIR},i),a=this._getCacheItem(o),s=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=i.serviceProvider||this.SERVICE_PROVIDER,c=i.columnDistinctValues||e.columnDistinctValues,p=u+c+this._parseUidAndVersion(i,!1)+"/"+i.columnId;return n(t.ajax({url:p,type:i.type||"GET",dataType:i.dataType||"json"})).then(function(e){return s._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(s._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.getEnumeration=function(i){var o=r.extend({type:"enumeration",environment:this.ENVIR},i),a=this._getCacheItem(o),s=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=i.serviceProvider||this.SERVICE_PROVIDER,c=i.enumerationService||e.enumerationService;return n(t.ajax({url:u+c+i.uid,type:i.type||"GET",dataType:i.dataType||"json"})).then(function(e){return s._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(s._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.getCodeList=function(i){var o=r.extend({type:"codelist",environment:this.ENVIR},i),a=this._getCacheItem(o),s=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=i.serviceProvider||this.SERVICE_PROVIDER,c=i.codeListService||e.codelistService,p=i.body;return n(t.ajax({url:u+c+this._parseQueryParams(i.params),type:i.type||"POST",dataType:i.dataType||"json",contentType:i.contentType||"application/json",data:JSON.stringify(p)})).then(function(e){return s._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(s._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.getResource=function(i){var o=r.extend({type:"resource",environment:this.ENVIR},i),a=this._getCacheItem(o),s=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=i.serviceProvider||this.SERVICE_PROVIDER,c=i.processesService||e.resourcesService,p=u+c+this._parseUidAndVersion(i,!0)+this._parseQueryParams(i.params);return n(t.ajax({url:p,type:i.type||"GET",contentType:i.contentType||"application/json",data:JSON.stringify(i.body)})).then(function(e){return s._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(s._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.getProcessedResource=function(i){var o=r.extend({type:"process",environment:this.ENVIR},i),a=this._getCacheItem(o),s=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=i.serviceProvider||this.SERVICE_PROVIDER,c=i.processesService||e.processesService,p=i.hasOwnProperty("uid"),d=u+c+(p?this._parseUidAndVersion(i,!1):"")+this._parseQueryParams(i.params);return n(t.ajax({url:d,type:i.type||"POST",dataType:i.dataType||"json",contentType:i.contentType||"application/json",data:JSON.stringify(i.body)})).then(function(e){return s._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(s._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.getMetadata=function(i){var o=r.extend({type:"metadata",environment:this.ENVIR},i),a=this._getCacheItem(o),s=this;if(this.USE_CACHE&&a)return n.promise(function(e){return e(a)});var u=i.serviceProvider||this.SERVICE_PROVIDER,c=i.metadataService||e.metadataService;return n(t.ajax({url:u+c+this._parseUidAndVersion(i,!0)+this._parseQueryParams(i.params),type:i.type||"GET",dataType:i.dataType||"json"})).then(function(e){return s._setCacheItem(o,e?e:null),n.promise(function(e,t,r){return e(s._getCacheItem(o))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype["export"]=function(r,i){var o=i&&i.serviceProvider||this.SERVICE_PROVIDER,a="";return a=null!=i&&"undefined"!=typeof i&&null!=i.params&&"undefined"!=typeof i.params?o+e.exportService+this._parseQueryParams(i.params):o+e.exportService,n(t.ajax({url:a,type:"POST",contentType:"application/json",data:JSON.stringify(r)})).then(function(e){var t={data:e,url:a};return n.promise(function(e,r,n){return e(t)})},function(e){return n.promise(function(t,r,n){return t(e)})})},s.prototype.exportFlow=function(r,i){var o=i&&i.serviceProvider||this.SERVICE_PROVIDER,a=o+e.exportFlow+this._parseQueryParams(i.params);return n(t.ajax({url:a,type:"POST",contentType:"application/json",data:JSON.stringify(r),dataType:"text"})).then(function(e){var t={data:e,url:a};return n.promise(function(e,r,n){return e(t)})},function(e){return n.promise(function(t,r,n){return t(e)})})},s.prototype.exportStreaming=function(r,i){var o=i&&i.serviceProvider||this.SERVICE_PROVIDER,a=o+e.exportStreaming+this._parseQueryParams(i.params);return n(t.ajax({url:a,type:"POST",contentType:"application/json",data:JSON.stringify(r),dataType:"text"})).then(function(e){var t={data:e,url:a};return n.promise(function(e,r,n){return e(t)})},function(e){return n.promise(function(t,r,n){return t(e)})})},s.prototype.getMDSD=function(i){var o=i||{},a=r.extend({type:"mdsd",environment:this.ENVIR},o),s=this._getCacheItem(a),u=this;if(this.USE_CACHE&&s)return n.promise(function(e){return e(s)});var c=o.serviceProvider||this.SERVICE_PROVIDER,p=o.mdsdService||e.mdsdService,d=c+p+this._parseQueryParams(o.params);return n(t.ajax({url:d,type:o.type||"GET",dataType:o.dataType||"json"})).then(function(e){return u._setCacheItem(a,e?e:null),n.promise(function(e,t,r){return e(u._getCacheItem(a))})},function(e){return n.promise(function(t,r,n){return r(e)})})},s.prototype.all=function(e){return n.all(e)},s.prototype.getCacheKey=function(e){return this._getCacheKey(e)},s.prototype._parseQueryParams=function(e){if(!e)return"";var t="?";return r.each(e,function(e,r){t+=r+"="+e+"&"}),t.substring(0,t.length-1)},s.prototype._parseUidAndVersion=function(e,t){var r="",n=!1;return e.uid||i.warn("Impossible to find uid"),r=r.concat(e.uid),e.version&&(r=r.concat("/").concat(e.version),n=!0),t===!0&&n!==!0?"uid/"+r:r},s.prototype._setCacheItem=function(e,t){var r=this.getCacheKey(e);try{a.sessionStorage(r,t)}catch(n){this.cache_db[r]=t}return this._getCacheItem(r)},s.prototype._getCacheItem=function(e){var t=this.getCacheKey(e),r=a.sessionStorage(t);return r?r:this.cache_db[t]},s.prototype._getCacheKey=function(e){var t=o(e);return t},s}.apply(t,n),!(void 0!==i&&(e.exports=i))},function(e,t,r){var n;n=function(){"use strict";var e="//fenix.fao.org/",t="//fenixservices.fao.org/",r="//fenix.fao.org/",n="//www.fao.org/fenix/wiews/api/",i="//www-test.fao.org/fenix/wiews/api/";return{serviceProviderProduction:t+"d3s/",serviceProviderDevelop:e+"d3s_dev/",serviceProviderDemo:r+"d3s/",serviceProviderWiews:r+"d3s_wiews/",serviceProviderWiews_qa:n+"d3s/",serviceProviderWiews_production:i+"d3s/",exportService:"/fenix/export",exportFlow:"/export/flow",exportStreaming:"/export/",findService:"msd/resources/find",codelistService:"msd/codes/filter",enumerationService:"msd/choices/",processesService:"processes/",metadataService:"msd/resources/metadata/",dsdService:"msd/resources/dsd",resourcesService:"msd/resources/",mdsdService:"mdsd/",columnDistinctValues:"dataset/distinct/",cache:!0}}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=o}])});
//# sourceMappingURL=fenix-ui-bridge.min.js.map